dev.test:
  run:
    - cargo build
    - cargo test
    - cargo fmt -- --check
    - cargo clippy -- -D warnings

dev:
  release:
    git:
      depends:
        - dev.test
      run:
        - git add -A
        - git commit -S
        - git push

    git.redo:
      depends:
        - dev.test
      run:
        - git add -A
        - git commit -S --amend --no-edit
        - git push --force

    snap:
      run:
        - snapcraft
    
    debian.point-release:
      run:
        - debclean
        - tar --exclude-vcs --exclude=.gitignore --exclude=.github --exclude=target --exclude=snap --exclude=debian -cvJf ../dovetail_$(dpkg-parsechangelog --show-field Version | cut -d- -f1).orig.tar.xz .
        - debuild -S -sa -k5A93D31B99D80FBFE7A97F8665EFA24128E424B3
        - dput ppa:bryanfraschetti/dovetail ../dovetail_$(dpkg-parsechangelog --show-field Version)_source.changes

    debian.patch:
      run:
        - debclean
        - tar --exclude-vcs --exclude=.gitignore --exclude=.github --exclude=target --exclude=snap --exclude=debian -cvJf ../dovetail_$(dpkg-parsechangelog --show-field Version | cut -d- -f1).orig.tar.xz .
        - debuild -S -k5A93D31B99D80FBFE7A97F8665EFA24128E424B3
        - dput ppa:bryanfraschetti/dovetail ../dovetail_$(dpkg-parsechangelog --show-field Version)_source.changes

clean:
  run:
    - rm ../dovetail_*
    - cargo clean
    - rm dovetail*snap

install:
  run:
    # Doesn't work if which dovetail == /snap/bin/dovetail since the
    # snap would be running this process
    - snap install dovetail*snap --dangerous
